version: 0.2


phases:
  install:
    runtime-versions:
      python: 3.7

  build:
    commands:
      - yum upgrade -y
      - echo "{\"version\":\"${CODEBUILD_RESOLVED_SOURCE_VERSION}\"}" > SearchAPI/version.json
      - sam build
      - docker image ls
      - sam deploy --region ${AWS_REGION} --stack-name SearchAPI-devel-staging --image-repository $(aws sts get-caller-identity --query Account --output text).dkr.ecr.${AWS_REGION}.amazonaws.com/searchapi-devel-staging --tags KeyName1=latest KeyName2=GITHUB_HASH_HERE_TODO --capabilities CAPABILITY_IAM --no-fail-on-empty-changeset
